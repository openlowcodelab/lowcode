@page "/form/{PageId}/{DataId}"

@using H.LowCode.Schema

@inject HttpClient Http
@inject IRender render

@RenderFragment

@code {
    [Parameter]
    public string PageId { get; set; }

    [Parameter]
    public string DataId { get; set; }

    public RenderFragment RenderFragment { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        // 渲染组件
        await RenderComponentAsync();
    }

    //protected override async Task OnAfterRenderAsync(bool firstRender)
    //{
    //    // 渲染表单数据
    //    await RenderFormDataAsync();
    //}

    /// <summary>
    /// 渲染组件
    /// </summary>
    /// <returns></returns>
    private async Task RenderComponentAsync()
    {
        var jSchema = await Http.GetFromJsonAsync<object>($"jsonschema/form/{PageId}.json?_={DateTime.Now.Ticks}");
        var jsonSchema = JSchema.Parse(jSchema.ToString());

        RenderFragment = render.Render(jsonSchema, PageRenderType.Form);
    }

    /// <summary>
    /// 渲染表单数据
    /// </summary>
    /// <returns></returns>
    private async Task RenderFormDataAsync()
    {
        string serverUrl = "http://localhost:5005";

        var formData = await Http.PostAsJsonAsync<PageSchema>($"{serverUrl}/GetFormData?id={DataId}", null);

    }
}