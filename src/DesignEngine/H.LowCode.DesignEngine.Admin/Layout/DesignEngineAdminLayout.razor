@inherits LayoutComponentBase

<AntDesign.ProLayout.BasicLayout Class="designengineadmin" Logo="@("logo.png")" Title="@AppId" MenuData="_menuData"
    Layout="AntDesign.ProLayout.Layout.Side">
    <RightContentRender>
        RightContent
    </RightContentRender>
    <ChildContent>
        @Body
    </ChildContent>
    <FooterRender></FooterRender>
</AntDesign.ProLayout.BasicLayout>
<SettingDrawer />

@code
{
    [Parameter]
    public string AppId { get; set; }

    private MenuDataItem[] _menuData;

    protected override async Task OnInitializedAsync()
    {
        InitAppId();
        InitMenuData(AppId);

        await base.OnInitializedAsync();
    }

    private void InitAppId()
    {
        if ((this.Body.Target as RouteView)?.RouteData.RouteValues?.TryGetValue("AppId", out object appId) == true)
        {
            AppId = appId?.ToString();
        }

        if (string.IsNullOrEmpty(AppId))
            throw new NullReferenceException(nameof(AppId));
    }

    private void InitMenuData(string appId)
    {
        _menuData = [
            new MenuDataItem
            {
                Path = $"/myapp/{appId}/pagemanager",
                Name = "页面管理",
                Icon = "profile",
                Key = "page"
            },
            new MenuDataItem
            {
                Path = $"/myapp/{appId}/menumanager",
                Name = "菜单管理",
                Icon = "menu",
                Key = "menu"
            },
            new MenuDataItem
            {
                Path = $"/myapp/{appId}/datasource",
                Name = "数据源",
                Icon = "database",
                Key = "datasource"
            },
            new MenuDataItem
            {
                Path = $"/myapp/{appId}/publish",
                Name = "应用发布",
                Icon = "cloud-upload",
                Key = "publish"
            },
            new MenuDataItem
            {
                Path = $"/myapp/{appId}/appsettings",
                Name = "应用设置",
                Icon = "setting",
                Key = "appsettings"
            }
        ];
    }
}