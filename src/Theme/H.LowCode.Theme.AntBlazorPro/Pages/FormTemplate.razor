@page "/form/{PageId}/{DataId}"

@inject IHttpClientFactory HttpClientFactory
@inject IRender render

@RenderFragment

@code {
    [Parameter]
    public string PageId { get; set; }

    [Parameter]
    public string DataId { get; set; }

    public RenderFragment RenderFragment { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        // 渲染组件
        await RenderComponentAsync();
    }

    //protected override async Task OnAfterRenderAsync(bool firstRender)
    //{
    //    // 渲染表单数据
    //    await RenderFormDataAsync();
    //}

    /// <summary>
    /// 渲染组件
    /// </summary>
    /// <returns></returns>
    private async Task RenderComponentAsync()
    {
        var httpClient = HttpClientFactory.CreateClient();
        var pageSchema = await httpClient.GetFromJsonAsync<PageSchema>($"jsonschema/form/{PageId}.json?_={DateTime.Now.Ticks}");

        RenderFragment = render.Render(pageSchema, PageRenderType.Form);
    }

    /// <summary>
    /// 渲染表单数据
    /// </summary>
    /// <returns></returns>
    private async Task RenderFormDataAsync()
    {
        string serverUrl = "http://localhost:5005";

        var httpClient = HttpClientFactory.CreateClient();
        var formData = await httpClient.PostAsJsonAsync<PageSchema>($"{serverUrl}/GetFormData?id={DataId}", null);

    }
}